(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{ObQG:function(T,P,t){T.exports={container:"container___1sYa-",lang:"lang___l6cji",content:"content___2zk1-",top:"top___1C1Zi",header:"header___5xZ3f",logo:"logo___2hXsy",title:"title___1-xuF",desc:"desc___-njyT",main:"main___x4OjT",icon:"icon___rzGKO",other:"other___lLyaU",register:"register___11Twg",prefixIcon:"prefixIcon___23Xrx"}},PdsH:function(T,P,t){"use strict";t.r(P);var Me=t("2qtc"),Z=t("kLXV"),De=t("+L6B"),C=t("2/Rp"),Ie=t("miYZ"),f=t("tsqr"),d=t("qLMh"),E=t("k1fw"),g=t("9og8"),u=t("tJVT"),Q=t("cJ7L"),Y=t("FY4R"),c=t("q1tI"),Te=t.n(c),H=t("VMEa"),S=t("Qurx"),q=t("tneF"),j=t("9kvl"),ee=t("55Ip"),te=t("CwrG"),ae=t("74pX"),L=t("zv96"),ne=t("ObQG"),l=t.n(ne),U=t("kZX9"),_=t("HOj0"),se=t("p46w"),x=t.n(se),re=t("Fghh"),a=t("nKUr"),Ce=t.n(a),_e=function(){!j.f||setTimeout(function(){var M=j.f.location.query,h=M,p=h.redirect;j.f.push(p||"/")},10)},ie=function(){var M=Object(c.useState)(!1),h=Object(u.a)(M,2),p=h[0],B=h[1],le=Object(c.useState)({}),R=Object(u.a)(le,2),Se=R[0],ce=R[1],de=Object(c.useState)({}),y=Object(u.a)(de,2),m=y[0],K=y[1],ue=Object(c.useState)("password"),A=Object(u.a)(ue,2),W=A[0],Oe=A[1],N=Object(j.l)("@@initialState"),b=N.initialState,je=N.setInitialState,me=Object(c.useState)(!0),k=Object(u.a)(me,2),be=k[0],F=k[1],ve=Object(c.useState)(!1),w=Object(u.a)(ve,2),fe=w[0],D=w[1],Ee=Object(c.useState)([]),z=Object(u.a)(Ee,2),I=z[0],G=z[1],ge=Object(c.useState)(!0),V=Object(u.a)(ge,2),he=V[0],X=V[1],pe=function(){var i=Object(g.a)(Object(d.a)().mark(function e(){var n,r;return Object(d.a)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,b==null||(n=b.fetchUserInfo)===null||n===void 0?void 0:n.call(b);case 2:r=s.sent,r&&je(Object(E.a)(Object(E.a)({},b),{},{currentUser:r}));case 4:case"end":return s.stop()}},e)}));return function(){return i.apply(this,arguments)}}();Object(c.useEffect)(function(){var i=m.username;!i||Object(U.c)("/api/geTenants",{username:i}).then(function(e){G(e==null?void 0:e.datas)})},[m==null?void 0:m.username]);var $=function(e){localStorage.setItem("dlink-tenantId",e.toString()),x.a.set("tenantId",e.toString(),{path:"/"})},J=function(){var i=Object(g.a)(Object(d.a)().mark(function e(n){var r;return Object(d.a)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(be){s.next=2;break}return s.abrupt("return");case 2:return F(!1),setTimeout(function(){F(!0)},200),B(!0),s.prev=5,s.next=8,Object(ae.b)(Object(E.a)(Object(E.a)({},n),{},{type:W}));case 8:if(r=s.sent,!(r.code===0&&r.datas!=null)){s.next=17;break}return f.default.success(Object(_.a)("pages.login.success")),s.next=13,pe();case 13:return _e(),s.abrupt("return");case 17:f.default.error(Object(_.a)(r.msg,r.msg));case 18:ce(r.datas),s.next=24;break;case 21:s.prev=21,s.t0=s.catch(5),f.default.error(Object(_.a)("pages.login.failure"));case 24:B(!1);case 25:case"end":return s.stop()}},e,null,[[5,21]])}));return function(n){return i.apply(this,arguments)}}(),Pe=function(){return Object(a.jsx)(a.Fragment,{children:Object(a.jsx)(Z.a,{title:Object(_.a)("pages.login.chooseTenant"),visible:fe,destroyOnClose:!0,width:"60%",onCancel:function(){D(!1)},footer:[Object(a.jsx)(C.a,{onClick:function(){D(!1)},children:Object(_.a)("button.close")},"back"),Object(a.jsx)(C.a,{disabled:he,type:"primary",loading:p,onClick:Object(g.a)(Object(d.a)().mark(function e(){return Object(d.a)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,J(m);case 2:case"end":return r.stop()}},e)})),children:Object(_.a)("button.confirm")},"submit")],children:Object(a.jsx)(L.a.Group,{multiple:!1,onChange:function(n){n?(X(!1),m.tenantId=n,$(n)):X(!0)},children:I==null?void 0:I.map(function(e){return Object(a.jsx)(a.Fragment,{children:Object(a.jsx)(L.a,{size:"default",avatar:"/icons/tenant_default.svg",title:e==null?void 0:e.tenantCode,value:e==null?void 0:e.id,description:e==null?void 0:e.note},e==null?void 0:e.id)})})})})})};return Object(a.jsxs)("div",{className:l.a.container,children:[Object(a.jsx)("div",{className:l.a.lang,children:j.b&&Object(a.jsx)(j.b,{onItemClick:function(e){var n=e.key.toString();(n===void 0||n==="")&&(n=localStorage.getItem("umi_locale")),x.a.set("language",n,{path:"/"}),Object(re.i)(n)}})}),Object(a.jsxs)("div",{className:l.a.content,children:[Object(a.jsxs)("div",{className:l.a.top,children:[Object(a.jsx)("div",{className:l.a.header,children:Object(a.jsxs)(ee.a,{to:"/",children:[Object(a.jsx)("img",{alt:"logo",className:l.a.logo,src:"/dinky.svg"}),Object(a.jsx)("span",{className:l.a.title,children:"Dinky"})]})}),Object(a.jsx)("div",{className:l.a.desc,children:Object(_.a)("pages.layouts.userLayout.title")})]}),Object(a.jsx)("div",{className:l.a.main,children:Object(a.jsxs)(H.a,{initialValues:{autoLogin:!0},submitter:{searchConfig:{submitText:Object(_.a)("pages.login.submit")},render:function(e,n){return n.pop()},submitButtonProps:{loading:p,size:"large",style:{width:"100%"},htmlType:"submit"}},onFinish:function(){var i=Object(g.a)(Object(d.a)().mark(function e(n){var r,v;return Object(d.a)().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return Oe("password"),O.next=3,Object(U.c)("/api/geTenants",{username:n.username}).then(function(o){if(!(o!=null&&o.datas)){f.default.error(o==null?void 0:o.msg);return}return G(o==null?void 0:o.datas),o==null?void 0:o.datas});case 3:if(r=O.sent,r.length!==1){O.next=13;break}return v=r.pop().id,n.tenantId=v,$(v),K(n),O.next=11,J(n);case 11:O.next=15;break;case 13:K(n),D(!0);case 15:case"end":return O.stop()}},e)}));return function(e){return i.apply(this,arguments)}}(),children:[W==="password"&&Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(S.a,{name:"username",fieldProps:{size:"large",prefix:Object(a.jsx)(Q.a,{className:l.a.prefixIcon})},placeholder:Object(_.a)("pages.login.username.placeholder"),rules:[{required:!0,message:Object(_.a)("pages.login.username.required")}]}),Object(a.jsx)(S.a.Password,{name:"password",fieldProps:{size:"large",prefix:Object(a.jsx)(Y.a,{className:l.a.prefixIcon})},placeholder:Object(_.a)("pages.login.password.placeholder"),rules:[{required:!0,message:Object(_.a)("pages.login.password.required")}]})]}),Object(a.jsxs)("div",{style:{marginBottom:24},children:[Object(a.jsx)(q.a,{noStyle:!0,name:"autoLogin",children:Object(_.a)("pages.login.rememberMe")}),Object(a.jsx)("a",{style:{float:"right"},children:Object(_.a)("pages.login.forgotPassword")})]})]})})]}),Object(a.jsx)(te.a,{}),Pe()]})};P.default=ie}}]);
